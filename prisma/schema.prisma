// LearnTeam Prisma Schema (SQLite)
// í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼: Supabase Auth + ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

// ì‚¬ìš©ì í”„ë¡œí•„ (Supabase Authì™€ ì—°ë™)
// idëŠ” Supabase auth.usersì˜ UUIDë¥¼ ì‚¬ìš©
model User {
  id        String   @id // Supabase auth.users.id
  email     String   @unique
  name      String?
  avatarUrl String?  @map("avatar_url")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  teamsCreated    Team[]        @relation("TeamCreator")
  teamMemberships TeamMember[]
  learningLogs    LearningLog[]
  portfolios      Portfolio[]
  curatedLinks    CuratedLink[]

  @@map("users")
}

// íŒ€
model Team {
  id          String   @id @default(uuid())
  name        String
  description String?
  createdBy   String   @map("created_by")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  creator      User          @relation("TeamCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  members      TeamMember[]
  learningLogs LearningLog[]
  portfolios   Portfolio[]
  curatedLinks CuratedLink[]

  @@map("teams")
}

// íŒ€ ë©¤ë²„
model TeamMember {
  id       String   @id @default(uuid())
  teamId   String   @map("team_id")
  userId   String   @map("user_id")
  role     String   @default("member") // 'leader' or 'member'
  joinedAt DateTime @default(now()) @map("joined_at")

  // Relations
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@map("team_members")
}

// í•™ìŠµ ë¡œê·¸
model LearningLog {
  id           String   @id @default(uuid())
  teamId       String   @map("team_id")
  createdBy    String   @map("created_by")
  title        String
  description  String?
  whatLearned  String   @map("what_learned") // JSON string (ë°°ì—´)
  improvements String? // JSON string (ë°°ì—´)
  nextSteps    String?  @map("next_steps") // JSON string (ë°°ì—´)
  tags         String? // JSON string (ë°°ì—´)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  team    Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  creator User @relation(fields: [createdBy], references: [id], onDelete: Cascade)

  @@map("learning_logs")
}

// í¬íŠ¸í´ë¦¬ì˜¤
model Portfolio {
  id        String   @id @default(uuid())
  teamId    String   @map("team_id")
  userId    String // ğŸ”§ Int â†’ String!
  user      User     @relation(fields: [userId], references: [id])
  title     String
  summary   String?
  content   String? // Markdown
  publicUrl String?  @unique @map("public_url")
  isPublic  Boolean  @default(false) @map("is_public")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@map("portfolios")
}

// íë ˆì´ì…˜ ë§í¬ (ê¸€ íë ˆì´ì…˜)
model CuratedLink {
  id        String   @id @default(uuid())
  teamId    String   @map("team_id")
  createdBy String   @map("created_by")
  title     String
  url       String
  type      String? // 'article', 'video', 'tutorial'
  notes     String?
  tags      String? // JSON string (ë°°ì—´)
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  team    Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  creator User @relation(fields: [createdBy], references: [id], onDelete: Cascade)

  @@map("curated_links")
}
